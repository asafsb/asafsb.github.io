<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Asaf Blubshtein">

  
  
  
    
  
  <meta name="description" content="HCX 4.0 introduced plenty of new  features and functionalities, such as migration details and security tag migrations to name a few. One of the features I like the most is In-Service Upgrade for the network extension appliance(s). While the standard upgrade re-deploys the network extension (NE) appliance, the in-service upgrade will deploy an extra appliance with a new set of IPs prior to removing the old appliance. This will allow HCX to establish a tunnel between the two new appliances and then do a switchover to minimize downtime for the extended networks.
To compare the downtime the extended networks experience using each upgrade method, I tested the impact of each one on the connectivity between two VMs while redeploying the NE appliances.">

  
  <link rel="alternate" hreflang="en-us" href="https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/">

  


  
  
  
  <meta name="theme-color" content="#FDFDFD">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/tomorrow-night-blue.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/tomorrow-night-blue.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161733961-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-161733961-1', { 'anonymize_ip': true });

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu2d386f00a90cc1e6a45c94eb95a50635_27399_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu2d386f00a90cc1e6a45c94eb95a50635_27399_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@AsafBlubshtein">
  <meta property="twitter:creator" content="@AsafBlubshtein">
  
  <meta property="og:site_name" content="Software-Defined Coffee">
  <meta property="og:url" content="https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/">
  <meta property="og:title" content="Testing In-Service Upgrade for HCX Network Extension Appliances | Software-Defined Coffee">
  <meta property="og:description" content="HCX 4.0 introduced plenty of new  features and functionalities, such as migration details and security tag migrations to name a few. One of the features I like the most is In-Service Upgrade for the network extension appliance(s). While the standard upgrade re-deploys the network extension (NE) appliance, the in-service upgrade will deploy an extra appliance with a new set of IPs prior to removing the old appliance. This will allow HCX to establish a tunnel between the two new appliances and then do a switchover to minimize downtime for the extended networks.
To compare the downtime the extended networks experience using each upgrade method, I tested the impact of each one on the connectivity between two VMs while redeploying the NE appliances."><meta property="og:image" content="https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/featured.png">
  <meta property="twitter:image" content="https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2021-06-04T01:00:11&#43;00:00">
    
    <meta property="article:modified_time" content="2021-06-04T01:00:11&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/"
  },
  "headline": "Testing In-Service Upgrade for HCX Network Extension Appliances",
  
  "image": [
    "https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/featured.png"
  ],
  
  "datePublished": "2021-06-04T01:00:11Z",
  "dateModified": "2021-06-04T01:00:11Z",
  
  "author": {
    "@type": "Person",
    "name": "Asaf Blubshtein"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Software-Defined Coffee",
    "logo": {
      "@type": "ImageObject",
      "url": "https://softwaredefinedcoffee.com/images/logo_hu6a9919c281d1691f5c19a9c9499d0583_79377_192x192_fit_lanczos_2.png"
    }
  },
  "description": "HCX 4.0 introduced plenty of new  features and functionalities, such as migration details and security tag migrations to name a few. One of the features I like the most is In-Service Upgrade for the network extension appliance(s). While the standard upgrade re-deploys the network extension (NE) appliance, the in-service upgrade will deploy an extra appliance with a new set of IPs prior to removing the old appliance. This will allow HCX to establish a tunnel between the two new appliances and then do a switchover to minimize downtime for the extended networks.\nTo compare the downtime the extended networks experience using each upgrade method, I tested the impact of each one on the connectivity between two VMs while redeploying the NE appliances."
}
</script>

  

  


  
  
  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js" integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css" integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#424242",
          "text": "#fff"
        },
        "button": {
          "background": "#606060",
          "text": "#FDFDFD"
        }
      },
      "theme": "classic",
      "content": {
        "message": "This website uses cookies to ensure you get the best experience on our website.",
        "dismiss": "Got it!",
        "link": "Learn more",
        "href": "/privacy/"
      }
    })});
  </script>



  





  <title>Testing In-Service Upgrade for HCX Network Extension Appliances | Software-Defined Coffee</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  






  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/images/logo_hu6a9919c281d1691f5c19a9c9499d0583_79377_0x70_resize_lanczos_2.png" alt="Software-Defined Coffee"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/images/logo_hu6a9919c281d1691f5c19a9c9499d0583_79377_0x70_resize_lanczos_2.png" alt="Software-Defined Coffee"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#header"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Testing In-Service Upgrade for HCX Network Extension Appliances</h1>

  

  
    



<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span><a href="/authors/admin/">Asaf Blubshtein</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    Jun 4, 2021
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    5 min read
  </span>
  

  
  
  

  
  
  
  <span class="middot-divider"></span>
  <a class="gc-counter" data-url="https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/#graphcomment"></a>
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/hcx/">HCX</a>, <a href="/categories/networking/">Networking</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      <p>HCX 4.0 introduced plenty of new <u>
<a href="https://blogs.vmware.com/networkvirtualization/2021/02/introducing-hcx4-0.html/" target="_blank" rel="noopener">features and functionalities</a></u>, such as migration details and security tag migrations to name a few. One of the features I like the most is In-Service Upgrade for the network extension appliance(s). While the standard upgrade re-deploys the network extension (NE) appliance, the in-service upgrade will deploy an extra appliance with a new set of IPs prior to removing the old appliance. This will allow HCX to establish a tunnel between the two new appliances and then do a switchover to minimize downtime for the extended networks.</p>
<p>To compare the downtime the extended networks experience using each upgrade method, I tested the impact of each one on the connectivity between two VMs while redeploying the NE appliances. You can read about the steps I performed or jump straight to the test conclusion:</p>
<ul>
<li><strong><u>
<a href="#test-environment-overview">Test Environment Overview</a></u></strong></li>
<li><strong><u>
<a href="#standard-upgrade">Standard Upgrade</a></u></strong></li>
<li><strong><u>
<a href="#in-service-upgrade">In-Service Upgrade</a></u></strong></li>
<li><strong><u>
<a href="#conclusion">Conclusion</a></u></strong></li>
</ul>
<div class="alert alert-note">
  <div>
    This test was performed in my lab environment, so the actual results in other environments may vary
  </div>
</div>
<h3 id="test-environment-overview">Test Environment Overview</h3>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image1_hu7980b5664fe651ea4f50c3741ba363a1_138931_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image1_hu7980b5664fe651ea4f50c3741ba363a1_138931_2000x2000_fit_lanczos_2.png" class="lazyload" alt="Test Environment Diagram" width="1033" height="652">
</a>



</figure>

<p>To perform the test I am using my home lab, located in Chicago, and a VMware Cloud on AWS SDDC in Oregon (us-west-2). Both sites are connected via route-based VPN and have HCX deployed and a service mesh configured:





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image2_huc2a9878b0dbf41498a44b6ef06ff4651_67565_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image2_huc2a9878b0dbf41498a44b6ef06ff4651_67565_2000x2000_fit_lanczos_2.png" class="lazyload" alt="HCX Service Mesh" width="1301" height="343">
</a>



</figure>
</p>
<p>A single network, <strong>site1-vlan11</strong>, is extended between the sites. The CIDR range is <strong>172.25.11.0/24</strong> and my lab&rsquo;s pfSense functions as the default gateway for the network. The pfSense is also the default gateway of the other network I&rsquo;m using, <strong>core-vlan10</strong> which uses CIDR <strong><strong>172.25.10.0/24</strong></strong>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image3_hu3d5a62a52e884eb650b00f6c87e86939_96939_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image3_hu3d5a62a52e884eb650b00f6c87e86939_96939_2000x2000_fit_lanczos_2.png" class="lazyload" alt="HCX Network Extension" width="1514" height="388">
</a>



</figure>
</p>
<p>The following VMs were used to test the connectivity:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Location</th>
<th>Portgroup</th>
<th>IP Address</th>
<th>OS</th>
</tr>
</thead>
<tbody>
<tr>
<td>core-mint</td>
<td>On-prem</td>
<td>core-vlan10</td>
<td>172.25.10.212</td>
<td>Linux Mint</td>
</tr>
<tr>
<td>sdcoffee-vlan11</td>
<td>VMW on AWS</td>
<td>L2E_site1-vlan11-11-189c7e98</td>
<td>172.25.11.236</td>
<td>Photon OS</td>
</tr>
</tbody>
</table>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image4_huf66d987e5032ce932f902b233adffb6d_123383_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image4_huf66d987e5032ce932f902b233adffb6d_123383_2000x2000_fit_lanczos_2.png" class="lazyload" alt="Remote Cloud VM" width="1083" height="644">
</a>



</figure>

<p>Before running the tests, the NE appliance on-prem is deployed with the following IPs:</p>
<table>
<thead>
<tr>
<th>Traffic type</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>Management Network</td>
<td>172.25.10.22</td>
</tr>
<tr>
<td>Uplink Network</td>
<td>192.168.1.222</td>
</tr>
</tbody>
</table>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image5_hub5a1bafd8a008fb7a2fed1e978594019_157323_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image5_hub5a1bafd8a008fb7a2fed1e978594019_157323_2000x2000_fit_lanczos_2.png" class="lazyload" alt="NE Appliance IPs - Start" width="1220" height="529">
</a>



</figure>

<p>To simulate the process that occurs during an appliance upgrade I opted to redeploy the appliances, as this gives me the option of running the test several times without needing to wait for a new version to upgrade to. To redeploy the appliances, follow these steps:</p>
<ol>
<li>Open the HCX plugin in vCenter or connect to the HCX manager</li>
<li>Select <strong>Interconnect</strong> and then the <strong>Service Mesh</strong> tab</li>
<li>Under the service mesh you&rsquo;d like to test, click <strong>View Appliances</strong></li>
<li>Select the NE appliance and click <strong>Redeploy</strong></li>
<li>You&rsquo;d then have the option of selecting <strong>Standard</strong> or <strong>In-Service</strong> mode</li>
<li>Once the redeployment is initiated, the specific steps and actions taken can be viewed in the <strong>Tasks</strong> tab</li>
</ol>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image6_hu80334f006cc5a939614847c034fb3307_112609_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image6_hu80334f006cc5a939614847c034fb3307_112609_2000x2000_fit_lanczos_2.png" class="lazyload" alt="HCX Redeploy" width="703" height="783">
</a>



</figure>

<h3 id="standard-upgrade">Standard Upgrade</h3>
<p>Before redeploying the NE appliance I launched the following ping command from <strong>core-mint</strong>, which provides a timestamp and will also show failed ping packets:</p>
<pre><code class="language-bash">ping -i 1 -O 172.25.11.236 | ts &quot;%H:%M:%.S&quot;
</code></pre>
<p>Next, I redeployed the NE appliance using <strong>Standard</strong> mode:</p>
<p><img src="image7.png" alt="NE Redeployment - Standard"></p>
<p>During the redeployment process, a new NE appliance will be deployed in both the source and destination sites. In this screenshot, we can see that a new NE appliance is deployed on-prem with the same IPs as the original appliance:</p>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image8_hu0a927395db291a3cf15773f511f35fd1_153607_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image8_hu0a927395db291a3cf15773f511f35fd1_153607_2000x2000_fit_lanczos_2.png" class="lazyload" alt="NE Appliance IPs - Standard" width="1222" height="537">
</a>



</figure>

<p>After a couple of minutes, HCX will start configuring the connectivity between the two new NE appliances:</p>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image9_hud74f062dedfc1d4be3192a794b6beb3d_29689_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image9_hud74f062dedfc1d4be3192a794b6beb3d_29689_2000x2000_fit_lanczos_2.png" class="lazyload" alt="NE redeploy task list - Standard " width="1023" height="105">
</a>



</figure>

<p>During this step, the tunnel is being established between the two appliances, which means downtime for the extended networks. In my environment the VMs lost connectivity for a little under <strong>25 seconds</strong>:</p>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image10_huf1ffbb441dda292c0c7dda194ca1c82c_92308_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image10_huf1ffbb441dda292c0c7dda194ca1c82c_92308_2000x2000_fit_lanczos_2.png" class="lazyload" alt="Ping test - Standard" width="724" height="470">
</a>



</figure>

<p>Once the tunnel is up and running HCX will remove the original appliances and will rename them.</p>
<h3 id="in-service-upgrade">In-Service Upgrade</h3>
<p>Similar to the steps performed in the standard mode test, I started a continuous timestamped ping from <strong>core-mint</strong>. However, when running the same command as I did previously for the first couple of tests I did not see any loss of packets (which is very promising!). Because of that, I changed the ping frequency to 200ms, which is the minimum possible:</p>
<pre><code class="language-bash">ping -i 0.2 -O 172.25.11.236 | ts &quot;%H:%M:%.S&quot;
</code></pre>
<p>Next, I redeployed the NE appliance using <strong>In-Service</strong> mode:</p>
<p><img src="image11.png" alt="NE Redeployment - Standard"></p>
<p>Once again, a new NE appliance will be deployed in both the source and destination sites. This time, as seen in the screenshot of the on-prem environment, the new NE appliance is deployed using a different set of IPs:</p>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image12_hu28615bda6c0eab6b03dedfc6e685b3d2_153758_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image12_hu28615bda6c0eab6b03dedfc6e685b3d2_153758_2000x2000_fit_lanczos_2.png" class="lazyload" alt="NE Appliance IPs - In-Service" width="1222" height="533">
</a>



</figure>

<p>As a comparison, here are the IPs of the original and newly deployed NE appliance on-prem:</p>
<table>
<thead>
<tr>
<th>Interface</th>
<th>Original NE Appliance</th>
<th>New NE Appliance</th>
</tr>
</thead>
<tbody>
<tr>
<td>Management IP</td>
<td>172.25.10.22</td>
<td>172.25.10.24</td>
</tr>
<tr>
<td>Uplink IP</td>
<td>192.168.1.222</td>
<td>192.168.1.224</td>
</tr>
</tbody>
</table>
<p>Since In-Service is using a new set of appliances with different IP addresses the tunnel configuration between them doesn&rsquo;t impact existing traffic. Instead, workloads are only experiencing a short amount of downtime during a new step, the <strong>NetExt Switchover</strong>:</p>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image13_hu09ec09b8b33d115b23ff1f7be1e6973c_89728_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image13_hu09ec09b8b33d115b23ff1f7be1e6973c_89728_2000x2000_fit_lanczos_2.png" class="lazyload" alt="NE redeploy task list - In-Service " width="1330" height="338">
</a>



</figure>

<p>Before this step, there are two sets of appliances with a tunnel established between them. During this step, the network extensions are switched over to the tunnel between the two new appliances. In my environment the VMs lost connectivity for <strong>just a little more than a second</strong>:</p>





  
  











<figure >


  <a data-fancybox="" href="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image14_hu90f1b4f62e0b0556dd877f43d7366a62_44488_2000x2000_fit_lanczos_2.png" >


  <img data-src="/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/image14_hu90f1b4f62e0b0556dd877f43d7366a62_44488_2000x2000_fit_lanczos_2.png" class="lazyload" alt="Ping test - In-Service" width="723" height="202">
</a>



</figure>

<p>Again, once the extensions are switched over to the new appliances HCX will remove the original appliances and rename them.</p>
<h3 id="conclusion">Conclusion</h3>
<p>Here is the summary of the results I got in the tests of the two upgrade/redeployment modes:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Standard Mode</th>
<th>In-Service Mode</th>
</tr>
</thead>
<tbody>
<tr>
<td>Network Downtime</td>
<td>24.55 Seconds</td>
<td>1.02 Seconds</td>
</tr>
<tr>
<td>Preparation</td>
<td>None Required</td>
<td>- Additional IP per NE appliance upgraded/redeployed <br> - Service mesh must be in a healthy state <br> - HCX 4.0 and above</td>
</tr>
</tbody>
</table>
<p>Just as a reminder, this was tested in my lab environment so your mileage may vary. That being said, the difference between the two modes is quite significant. While 25 seconds will definitely impact applications, most shouldn&rsquo;t even notice a 1 second outage, which is similar to what is experienced during vMotion.</p>
<p>Since most of the downtime the HCX extended networks experience is planned due to upgrades, In-Service mode can significantly improve the availability of workloads connected to extended networks.</p>

    </div>

    



<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/hcx/">HCX</a>
  
  <a class="badge badge-light" href="/tags/networking/">Networking</a>
  
  <a class="badge badge-light" href="/tags/vmc-on-aws/">VMC on AWS</a>
  
  <a class="badge badge-light" href="/tags/vmwonaws/">VMWonAWS</a>
  
  <a class="badge badge-light" href="/tags/vmware-cloud-on-aws/">VMware Cloud on AWS</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/&amp;text=Testing%20In-Service%20Upgrade%20for%20HCX%20Network%20Extension%20Appliances" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/&amp;t=Testing%20In-Service%20Upgrade%20for%20HCX%20Network%20Extension%20Appliances" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/&amp;title=Testing%20In-Service%20Upgrade%20for%20HCX%20Network%20Extension%20Appliances" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Testing%20In-Service%20Upgrade%20for%20HCX%20Network%20Extension%20Appliances%20https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://reddit.com/submit?url=https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/&amp;title=Testing%20In-Service%20Upgrade%20for%20HCX%20Network%20Extension%20Appliances" target="_blank" rel="noopener" class="share-btn-reddit">
          <i class="fab fa-reddit-alien"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://pinterest.com/pin/create/link/?url=https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/&amp;description=Testing%20In-Service%20Upgrade%20for%20HCX%20Network%20Extension%20Appliances" target="_blank" rel="noopener" class="share-btn-pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Testing%20In-Service%20Upgrade%20for%20HCX%20Network%20Extension%20Appliances&amp;body=https://softwaredefinedcoffee.com/post/2021-06-04-testing-in-service-upgrade-for-hcx-network-extension-appliances/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
  </ul>
</div>












  
    
    





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hu5918950e2ae61a1f706202ec8104aaf6_119822_270x270_fill_lanczos_center_2.png" alt="Asaf Blubshtein">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://softwaredefinedcoffee.com/">Asaf Blubshtein</a></h5>
      <h6 class="card-subtitle">Cloud Customer Success Architect</h6>
      <p class="card-text">My current role focuses on VMware Cloud on AWS. I spend the rest of my time with my wife, our two cats, my home-lab, and our espresso machine.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:sdcoffee.blog@gmail.com" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/asaf-blubshtein" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/AsafBlubshtein" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/asafsb" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/index.xml" >
        <i class="fas fa-rss"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  





<section id="comments">
  
    <div id="graphcomment"></div>

  
</section>




<div class="article-widget">
  
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/post/2021-05-19-configuring-route-based-vpn-between-vmware-cloud-on-aws-and-pfsense/" rel="prev">Configuring Route Based VPN Between VMware Cloud on AWS and pfSense</a>
  </div>
  
</div>

</div>



  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/2020-05-14-configuring-l2vpn-high-availability-in-vmw-on-aws/">Configuring L2VPN High Availability in VMware Cloud on AWS</a></li>
      
      <li><a href="/post/2021-05-19-configuring-route-based-vpn-between-vmware-cloud-on-aws-and-pfsense/">Configuring Route Based VPN Between VMware Cloud on AWS and pfSense</a></li>
      
      <li><a href="/post/2020-07-16-powershell-module-to-manage-workload-placement-in-vmwonaws-stretched-clusters/">PowerShell Module to Manage Workload Placement in VMware Cloud on AWS Stretched Clusters</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/powershell.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/python.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/bash.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/shell.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.4aaf2d64e50f8e54cf66dcc54147a22e.js"></script>

    






<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 56,
  backgroundColor: '#424242',
  textColor: '#fff'
})</script>





<script type="text/javascript">

    

  var gc_params = {
    graphcomment_id: 'Software-Defined-Coffee'
  };

   


  (function() {
    var gc = document.createElement('script'); gc.type = 'text/javascript'; gc.async = true;
    gc.src = 'https://graphcomment.com/js/integration.js?' + Date.now();
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(gc);
  })();

</script>





  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
  </p>
  

  <p class="powered-by">
    Â© 2021 Software-Defined Coffee &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.<br>
    Disclaimer: The views and opinions expressed on this blog are my own and do not reflect the views and opinions of my employer.
    
    
    
  </p>

</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
